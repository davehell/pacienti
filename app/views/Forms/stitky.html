#{extends 'main.html' /}
#{set title:'Štítky' /}


#{if pacienti}
<div class="span-18">
  <table class="display" id="pacTable">
    <thead>
      <th>&nbsp;</th>
      <th>&nbsp;</th>
      <th>Evidenční číslo</th>
      <th>Jméno</th>
      <th>Rodné číslo</th>
    </thead>
    <tbody>

    #{list pacienti}
    <tr>
      <td>${_.evCislo} </td>
      <td>${_.evRok} </td>
      <td><a href="" class="evCislo" title="">${_.getKod()}</a></td>
      <td>${_.jmeno} ${_.prijmeni} </td>
      <td>${_.getRodneCislo()} </td>
    </tr>
    #{/list}
    </tbody>
  </table>
</div> <!-- span-15 -->

<style type="text/css">
#stitky li {cursor: pointer;}
#print {display: none; margin-left: 1em;}
#deleteAll {display: none; }
</style>

<div class="span-5 push-1 last">
  <p>
    <strong>Vybrané štítky:</strong>
    <button id="print">Tisk</button>
    <button id="deleteAll">Odebrat vše</button>
  </p>
  <p id="neStitky">Nejsou vybrány žádné štítky.</p>
  <ul id="stitky">
  </ul>
  #{form @stitky(), id:"stitkyForm"}
  <input type="hidden" name="evCisla" id="evCisla" value="">
  
  #{/form}
</div> <!-- span-9 -->
<script type="text/javascript">
$(document).ready(function() {
    oTable = $('#pacTable').dataTable({
        "bJQueryUI": true,
        "sPaginationType": "full_numbers",
        "bStateSave": false,
        "aaSorting": [[ 1, "desc" ],[ 0, "desc" ]],
        "aLengthMenu": [[25, 50, 100, -1], [25, 50, 100, "Vše"]],
        "iDisplayLength":25,
        "aoColumnDefs": [
            { "bVisible": false, "aTargets": [ 0, 1 ] },
            { "bSearchable": false, "aTargets": [ 0, 1 ] }
        ]
    });

    //klik na evidenční číslo v tabulce pacientů
    $('.evCislo').click(function () {
      $("#stitky").append('<li>' + this.innerHTML + '</li>');
      slozStitky();
      $("#print").show();
      $("#deleteAll").show();
      $("#neStitky").hide();
      return false;
    } );

    //tlačítko odebrat všechny štítky
		$( "#deleteAll" ).button({
      icons: {
          primary: "ui-icon-trash"
      },
      text: false
    });

    $('#deleteAll').click(function() {
      $('#stitky li').remove();
      prazdneStitky();
    });

    //klik na položku v seznamu - odebraní daného štítku
    $('#stitky li').live('click', function() {
        $(this).remove();
        slozStitky();
        if($("#stitky li").size() == 0) prazdneStitky();
    });

    prazdneStitky = function() {
      $("#print").hide();
      $("#deleteAll").hide();
      $("#neStitky").show();
    };

    //všechny štítky spojí v jeden řetězec
    slozStitky = function() {
      var text = "";
      $("#stitky li").each(function(){
        if(text.length > 0) text += ";";
        text += $(this).text();
      });
      $("#evCisla").val(text);
    };

		$( "#print" ).button({
      icons: {
          primary: "ui-icon-print"
      },
      text: false
    });

    $('#print').click(function() {
      $('#stitkyForm').submit();
    });

} );
</script>
#{/if}
#{else}
    <div class="empty">
        &{'noRecords'}
    </div>
#{/else}

