#{extends 'main.html' /}

#{ifnot zprava?.id}
    #{set title:'Nové vyšetření' /}
#{/ifnot}
#{else}
    #{set title:'Vyšetření  ' + zprava.vysetreni.nazev /}
#{/else}

#{ifErrors}
    <p class="error">
        Opravte chyby ve formuláři!
    </p>
#{/ifErrors}

<form>
<fieldset>
  <legend>Pacient</legend>
  <ul>
   <li>${pacient?.jmeno} </li>
   <li>${pacient?.rodneCislo} </li>
  </ul>

#{if zprava?.bioMaterial?.id}
  <p>
    Biologický materiál: <em>${zprava.bioMaterial.typ}</em>
  </p>
#{/if}
#{if zprava?.vysetreni?.id}
  <input type="hidden" name="zprava.vysetreni.id" value="${zprava.vysetreni.id}">
  <p>
    Vyšetření: <em>${zprava.vysetreni.nazev}</em>
  </p>
#{/if}
</fieldset>
</form>

#{form @mySave(zprava?.id)}
<div class="span-12">
<fieldset>
  <legend>Vyšetření</legend>

#{if zprava?.bioMaterial?.id}
  <input type="hidden" name="zprava.bioMaterial.id" value="${zprava.bioMaterial.id}">
#{/if}
#{else}
  #{field 'zprava.bioMaterial.id'}
  <p>
    <label>&{field.name} </label><br>
    #{select "${field.name}", value:"${zprava?.bioMaterial?.id}", id:"${field.name}"}
    	#{option "0"}vyberte#{/option}
      #{list bioMaterialy}
        #{option "${_.id}"}${_.datumOdberu?.format()} - ${_.typ}#{/option}
      #{/list}
    #{/select}
    <span class="error">#{error 'zprava.bioMaterial.id' /} </span>
  </p>
  #{/}
#{/else}

#{if zprava?.vysetreni?.id}
  <input type="hidden" name="zprava.vysetreni.id" value="${zprava.vysetreni.id}">
#{/if}
#{else}
  #{field 'zprava.vysetreni.id'}
  <p>
    <label>&{field.name} </label><br>
    #{select "${field.name}", value:"${zprava?.vysetreni?.id}", id:"${field.name}"}
    	#{option "0"}vyberte#{/option}
      #{list vysetreni}
        #{option "${_.id}"}${_.nazev}#{/option}
      #{/list}
    #{/select}
    <span class="error">#{error 'vysetreni.id' /} </span>
  </p>
  #{/}
#{/else}

#{field 'zprava.datumVysetreni'}
<p>
  <label>&{field.name} </label><br>
  <input type="text" id="${field.id}" name="${field.name}" value="${zprava?.datumVysetreni?.format()}" class="${field.errorClass}">
  <span class="error">${field.error} </span>
</p>
#{/}

#{field 'zprava.parafaVysetreni.id'}
<p>
  <label>&{field.name} </label><br>
  #{select "${field.name}", value:"${zprava?.parafaVysetreni?.id}", id:"${field.name}"}
  	#{option }vyberte#{/option}
    #{list users}
      #{option "${_.id}"}${_.jmeno}#{/option}
    #{/list}
  #{/select}
  <span class="error">#{error 'zprava.parafaVysetreni ' /} </span>
</p>
#{/}

#{field 'zprava.parafaUvolneni'}
<p>
  <label>&{field.name} </label><br>
  <span class="small">${uvolnujiAnalyzu?.join(', ') } </span><br>
  <input type="text" id="${field.id}" name="${field.name}" value="${zprava?.parafaUvolneni}" class="${field.errorClass}">
  <span class="error">${field.error} </span>
</p>
#{/}

#{field 'zprava.vedouciLekar'}
<p>
  <label>&{field.name} </label><br>
  <span class="small">${vedouciLekari?.join(', ') } </span><br>
  <input type="text" id="${field.id}" name="${field.name}" value="${zprava?.vedouciLekar}" class="${field.errorClass}">
  <span class="error">${field.error} </span>
</p>
#{/}

#{field 'zprava.zavZprava'}
<p>
  <label>&{field.name} </label><br>
  <textarea id="${field.id}" name="${field.name}" class="${field.errorClass}">${zprava?.zavZprava}</textarea>
  <span class="error">${field.error} </span>
</p>
#{/}

#{field 'zprava.pozitivni'}
<p>
  <label>&{field.name} </label><br>
  <input type="checkbox" id="${field.id}" name="${field.name}" #{if zprava?.pozitivni} checked="checked" #{/if} class="${field.errorClass}">
  <span class="error">${field.error} </span>
</p>
#{/}

#{field 'zprava.datumPCR1'}
<p>
  <label>&{field.name} </label><br>
  <input type="text" id="${field.id}" name="${field.name}" value="${zprava?.datumPCR1?.format('dd.MM.yyyy')}" class="${field.errorClass}">
  <span class="error">${field.error} </span>
</p>
#{/}

#{field 'zprava.datumPCR2'}
<p>
  <label>&{field.name} </label><br>
  <input type="text" id="${field.id}" name="${field.name}" value="${zprava?.datumPCR2?.format('dd.MM.yyyy')}" class="${field.errorClass}">
  <span class="error">${field.error} </span>
</p>
#{/}

#{field 'zprava.datumElForezy'}
<p>
  <label>&{field.name} </label><br>
  <input type="text" id="${field.id}" name="${field.name}" value="${zprava?.datumElForezy?.format('dd.MM.yyyy')}" class="${field.errorClass}">
  <span class="error">${field.error} </span>
</p>
#{/}

#{field 'zprava.datumRevHybrid'}
<p>
  <label>&{field.name} </label><br>
  <input type="text" id="${field.id}" name="${field.name}" value="${zprava?.datumRevHybrid?.format('dd.MM.yyyy')}" class="${field.errorClass}">
  <span class="error">${field.error} </span>
</p>
#{/}

#{field 'zprava.datumFragmentAn'}
<p>
  <label>&{field.name} </label><br>
  <input type="text" id="${field.id}" name="${field.name}" value="${zprava?.datumFragmentAn?.format('dd.MM.yyyy')}" class="${field.errorClass}">
  <span class="error">${field.error} </span>
</p>
#{/}

#{field 'zprava.datumRTAn'}
<p>
  <label>&{field.name} </label><br>
  <input type="text" id="${field.id}" name="${field.name}" value="${zprava?.datumRTAn?.format('dd.MM.yyyy')}" class="${field.errorClass}">
  <span class="error">${field.error} </span>
</p>
#{/}

#{field 'zprava.datumSekv'}
<p>
  <label>&{field.name} </label><br>
  <input type="text" id="${field.id}" name="${field.name}" value="${zprava?.datumSekv?.format('dd.MM.yyyy')}" class="${field.errorClass}">
  <span class="error">${field.error} </span>
</p>
#{/}

<input type="hidden" name="pacientId" id="pacientId" value="${pacient?.id}">

    <p>
        <input type="submit" value="Uložit" />
    </p>
</fieldset>
</div>

<div class="span-12 last">
#{if zprava?.id}
<fieldset>
  <legend>Zjištěný genotyp</legend>
  #{list zprava?.vysledky}
    <p>
      <label>${_.genotyp.nazev} </label><br>
      <input type="hidden" name="vysledky[${_.id}].id" value="${_.id}">
      <input type="text" name="vysledky[${_.id}].vysledek" value="${_.vysledek}">
    </p>
  #{/list}
    <p>
        <input type="submit" value="Uložit" />
    </p>
</fieldset>
#{/if}
</div>
#{/form}

<script type="text/javascript">
    var calSetup = {
			showOn: "button",
      buttonImage: "@{'/public/images/calendar.gif'}",
			buttonImageOnly: true,
      dateFormat: "dd.mm.yy"
		};

		$( "#zprava_datumVysetreni" ).datepicker(calSetup);
		$( "#zprava_datumPCR1" ).datepicker(calSetup);
		$( "#zprava_datumPCR2" ).datepicker(calSetup);
		$( "#zprava_datumElForezy" ).datepicker(calSetup);
		$( "#zprava_datumRevHybrid" ).datepicker(calSetup);
		$( "#zprava_datumFragmentAn" ).datepicker(calSetup);
		$( "#zprava_datumRTAn" ).datepicker(calSetup);
		$( "#zprava_datumSekv" ).datepicker(calSetup);


	
		var vedouciLekari = [
      #{list vedouciLekari}
        "${_.raw()}" ${_isLast ? '' : ','}
      #{/list}
    ];

		$( "#zprava_vedouciLekar" ).autocomplete({
			source: vedouciLekari
		});

		var uvolnujiAnalyzu = [
      #{list uvolnujiAnalyzu}
        "${_.raw()}" ${_isLast ? '' : ','}
      #{/list}
    ];

		$( "#zprava_parafaUvolneni" ).autocomplete({
			source: uvolnujiAnalyzu
		});
	


</script>
